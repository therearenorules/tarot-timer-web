# ğŸ“ˆ íƒ€ë¡œ íƒ€ì´ë¨¸ ì›¹ì•± ê°œë°œ ì§„í–‰ í˜„í™© ë³´ê³ ì„œ

**ë³´ê³ ì„œ ë‚ ì§œ**: 2025-12-16 (Android Build 116 í”„ë¡œëª¨ì…˜ ì‹œìŠ¤í…œ ë° ì„±ëŠ¥ ìµœì í™”)
**í”„ë¡œì íŠ¸ ì „ì²´ ì™„ì„±ë„**: 99% - Supabase ê¸°ë°˜ ë™ì  í”„ë¡œëª¨ì…˜ ì‹œìŠ¤í…œ ì™„ì„±
**í˜„ì¬ ë²„ì „**:
- iOS v1.1.8 Build 204
- Android v1.1.8 Build 116 (í”„ë¡œë•ì…˜ ë°°í¬ ì¤€ë¹„ ì™„ë£Œ)
**ì•„í‚¤í…íŠ¸**: í¬ë¡œìŠ¤ í”Œë«í¼ + Supabase ì„œë²„ë¦¬ìŠ¤ ë°±ì—”ë“œ + ë™ì  í”„ë¡œëª¨ì…˜ ì‹œìŠ¤í…œ

---

## ğŸ”¥ **2025-12-16 ì£¼ìš” ì—…ë°ì´íŠ¸ - Build 116 í”„ë¡œëª¨ì…˜ ì‹œìŠ¤í…œ í˜ì‹ **

### 1. **Supabase ê¸°ë°˜ ë™ì  í”„ë¡œëª¨ì…˜ ì½”ë“œ ì‹œìŠ¤í…œ** âœ…

#### **ê¸°ì¡´ ì‹œìŠ¤í…œì˜ í•œê³„**
```typescript
// âŒ í•˜ë“œì½”ë”©ëœ í”„ë¡œëª¨ì…˜ ì½”ë“œ (constants/promoCodes.ts)
export const PROMO_CODES = [
  { code: 'TAROT2025', freeDays: 7 },
  { code: 'íƒ€ë¡œì‚¬ë‘', freeDays: 7 },
  // ìƒˆ ì½”ë“œ ì¶”ê°€ ì‹œ ì•± ì—…ë°ì´íŠ¸ í•„ìˆ˜
];
```

#### **ìƒˆë¡œìš´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜**
```
âœ… Supabase PostgreSQL ë°ì´í„°ë² ì´ìŠ¤
   â”œâ”€â”€ promo_codes í…Œì´ë¸” (ì½”ë“œ ë§ˆìŠ¤í„°)
   â”‚   â”œâ”€â”€ code: í”„ë¡œëª¨ì…˜ ì½”ë“œëª…
   â”‚   â”œâ”€â”€ free_days: ë¬´ë£Œ ê¸°ê°„ (ë™ì  ì„¤ì •)
   â”‚   â”œâ”€â”€ max_uses: ì‚¬ìš© íšŸìˆ˜ ì œí•œ
   â”‚   â”œâ”€â”€ valid_from/until: ìœ íš¨ ê¸°ê°„
   â”‚   â””â”€â”€ is_active: í™œì„±í™” ìƒíƒœ
   â”‚
   â”œâ”€â”€ promo_code_usage í…Œì´ë¸” (ì‚¬ìš© ë‚´ì—­)
   â”‚   â”œâ”€â”€ device_id: ë””ë°”ì´ìŠ¤ ê¸°ë°˜ ì¤‘ë³µ ë°©ì§€
   â”‚   â”œâ”€â”€ user_id: ì‚¬ìš©ì ID (ì„ íƒ)
   â”‚   â”œâ”€â”€ applied_at: ì ìš© ì‹œê°„
   â”‚   â””â”€â”€ expires_at: ë§Œë£Œ ì‹œê°„
   â”‚
   â””â”€â”€ RPC Functions
       â”œâ”€â”€ validate_promo_code(): ì‹¤ì‹œê°„ ê²€ì¦
       â””â”€â”€ apply_promo_code(): ì½”ë“œ ì ìš© + ì‚¬ìš© ë‚´ì—­ ìƒì„±
```

#### **êµ¬í˜„ ë‚´ìš©**

**1) ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ** (`supabase/migrations/create_promo_codes_table.sql`)
```sql
âœ… í…Œì´ë¸” ìƒì„± (promo_codes, promo_code_usage)
âœ… íŠ¸ë¦¬ê±° í•¨ìˆ˜ (ìë™ ì‚¬ìš© ì¹´ìš´íŠ¸ ì¦ê°€, updated_at ê°±ì‹ )
âœ… RLS ë³´ì•ˆ ì •ì±… (ì½ê¸°: ê³µê°œ, ì“°ê¸°: ê´€ë¦¬ìë§Œ)
âœ… í†µê³„ ë·° (promo_code_stats)
âœ… ì´ˆê¸° ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ (4ê°œ ê¸°ë³¸ ì½”ë“œ)
```

**2) ì„œë¹„ìŠ¤ ë ˆì´ì–´** (`services/promoService.ts`)
```typescript
âœ… Supabase RPC í•¨ìˆ˜ í˜¸ì¶œë¡œ ì„œë²„ ê²€ì¦
âœ… ë””ë°”ì´ìŠ¤ ID ê¸°ë°˜ ì¤‘ë³µ ì‚¬ìš© ë°©ì§€
âœ… ì˜¤í”„ë¼ì¸ ì§€ì› (ë¡œì»¬ ë°±ì—…)
âœ… PremiumContext ìë™ ë™ê¸°í™”
âœ… ì„±ëŠ¥ ìµœì í™” (ì•ˆë“œë¡œì´ë“œ IP ì¡°íšŒ ì œê±°)
```

**3) ê´€ë¦¬ì API** (`services/adminPromoService.ts`)
```typescript
âœ… createPromoCode(): ê°œë³„ ì½”ë“œ ìƒì„±
âœ… createBulkPromoCodes(): ëŒ€ëŸ‰ ì½”ë“œ ìƒì„±
âœ… getPromoCodeStats(): ì‹¤ì‹œê°„ í†µê³„
âœ… togglePromoCode(): í™œì„±í™”/ë¹„í™œì„±í™”
```

#### **í•µì‹¬ ê¸°ëŠ¥**

| ê¸°ëŠ¥ | ê¸°ì¡´ ì‹œìŠ¤í…œ | ìƒˆ ì‹œìŠ¤í…œ |
|------|------------|----------|
| **ì½”ë“œ ì¶”ê°€** | ì•± ì—…ë°ì´íŠ¸ í•„ìš” | Supabaseì—ì„œ ì¦‰ì‹œ ì¶”ê°€ |
| **ë¬´ë£Œ ê¸°ê°„** | ê³ ì • 7ì¼ | 1~365ì¼ ììœ  ì„¤ì • |
| **ì‚¬ìš© ì œí•œ** | ì—†ìŒ | íšŸìˆ˜/ê¸°ê°„ ì œí•œ ê°€ëŠ¥ |
| **ì¤‘ë³µ ë°©ì§€** | ë¡œì»¬ë§Œ | ì„œë²„ + ë””ë°”ì´ìŠ¤ ID |
| **í†µê³„** | ì—†ìŒ | ì‹¤ì‹œê°„ ì‚¬ìš© í˜„í™© |
| **ê´€ë¦¬** | ì½”ë“œ ìˆ˜ì • | SQL/ê´€ë¦¬ì API |

#### **ì„±ëŠ¥ ìµœì í™”**
```typescript
// ì•ˆë“œë¡œì´ë“œ ì„±ëŠ¥ ê°œì„  (3ì´ˆ ì§€ì—° ì œê±°)
const getIpAddress = async () => {
  if (Platform.OS !== 'web') {
    return null; // ëª¨ë°”ì¼ì—ì„œ IP ì¡°íšŒ ê±´ë„ˆëœ€
  }
  // Webë§Œ 1ì´ˆ íƒ€ì„ì•„ì›ƒìœ¼ë¡œ IP ì¡°íšŒ
};
```

#### **ìˆ˜ì •/ìƒì„±ëœ íŒŒì¼**
```
supabase/migrations/create_promo_codes_table.sql (ì‹ ê·œ 300ì¤„)
services/promoService.ts (Supabase ë²„ì „ìœ¼ë¡œ ì „ë©´ êµì²´ 300ì¤„)
services/adminPromoService.ts (ì‹ ê·œ 350ì¤„)
docs/PROMO_CODE_SETUP_GUIDE.md (ì‹ ê·œ 500ì¤„)
```

---

### 2. **ë² íƒ€ í…ŒìŠ¤íŠ¸ ë¬´ë£Œ ì´ìš© ì œê±°** âœ…

#### **ë¬¸ì œì **
```
ê¸°ì¡´: Android ë² íƒ€ í…ŒìŠ¤í„°ì—ê²Œ ìë™ìœ¼ë¡œ ë¬´ë£Œ í”„ë¦¬ë¯¸ì—„ ì œê³µ
â†’ ì •ì‹ ì¶œì‹œ ì‹œ ìˆ˜ìµí™” ë°©í•´ ìš”ì†Œ
```

#### **í•´ê²°ì±…**
```
âœ… ë² íƒ€ ë¬´ë£Œ ì´ìš© í”Œë˜ê·¸ ì™„ì „ ì œê±° (Commit: 3423ffb)
âœ… í”„ë¡œëª¨ì…˜ ì½”ë“œë¥¼ í†µí•œ í†µì œ ê°€ëŠ¥í•œ ë¬´ë£Œ ì²´í—˜ìœ¼ë¡œ ì „í™˜
âœ… ê´€ë¦¬ìê°€ ì§ì ‘ ìƒì„±í•œ ì½”ë“œë§Œ ìœ íš¨
```

#### **Git íˆìŠ¤í† ë¦¬**
```bash
3423ffb chore: Remove Android beta test free premium access
5e18c9a feat: Add promo code system for 7-day premium trial
```

---

### 3. **ì•ˆë“œë¡œì´ë“œ ì„±ëŠ¥ ìµœì í™” ë° ì•ˆì •ì„± ì ê²€** âœ…

#### **ì ê²€ í•­ëª©**

| í•­ëª© | ìƒíƒœ | ìµœì í™” ë‚´ìš© |
|------|------|------------|
| âš¡ **PromoService** | âœ… ì™„ë£Œ | IP ì¡°íšŒ ê±´ë„ˆëœ€ (3ì´ˆâ†’0ì´ˆ) |
| ğŸ”„ **PremiumContext** | âœ… ì–‘í˜¸ | Debounce + ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€ |
| ğŸ“¦ **ë²ˆë“¤ í¬ê¸°** | âœ… ì–‘í˜¸ | SVG ìµœì í™”, ì½”ë“œ ìŠ¤í”Œë¦¬íŒ… |
| ğŸ› **TypeScript** | âš ï¸ ë¹„Critical | Deno íƒ€ì… ì˜¤ë¥˜ë§Œ (ë¹Œë“œ ë¬´ê´€) |

#### **ì„±ëŠ¥ ê°œì„  ìƒì„¸**
```typescript
// Before: ëª¨ë“  í”Œë«í¼ì—ì„œ IP ì¡°íšŒ (3ì´ˆ íƒ€ì„ì•„ì›ƒ)
const getIpAddress = async () => {
  const response = await fetch('https://api.ipify.org', { timeout: 3000 });
  // Androidì—ì„œ ìµœëŒ€ 3ì´ˆ ì§€ì—° ë°œìƒ
};

// After: ì•ˆë“œë¡œì´ë“œ/iOSëŠ” ì¦‰ì‹œ ë¦¬í„´
const getIpAddress = async () => {
  if (Platform.OS !== 'web') return null; // 0ì´ˆ
  // Webë§Œ 1ì´ˆ íƒ€ì„ì•„ì›ƒ
};
```

---

### 4. **Android Build 116 í”„ë¡œë•ì…˜ ë¹Œë“œ ì„±ê³µ** âœ…

#### **ë¹Œë“œ ì •ë³´**
```
í”Œë«í¼: Android (AAB)
ë¹Œë“œ ë²ˆí˜¸: 115 â†’ 116 (ìë™ ì¦ê°€)
í”„ë¡œí•„: production-android
ë°°í¬ íŠ¸ë™: production (ì •ì‹ ì¶œì‹œ)
ìƒíƒœ: âœ… ë¹Œë“œ ì„±ê³µ
ë‹¤ìš´ë¡œë“œ: https://expo.dev/artifacts/eas/gfUtCQkFGNJD3eDRu3i2MX.aab
```

#### **ë¹Œë“œì— í¬í•¨ëœ ê¸°ëŠ¥**
```
âœ… Supabase ë™ì  í”„ë¡œëª¨ì…˜ ì‹œìŠ¤í…œ
âœ… ì•ˆë“œë¡œì´ë“œ ì„±ëŠ¥ ìµœì í™” (IP ì¡°íšŒ ì œê±°)
âœ… ë² íƒ€ ë¬´ë£Œ ì´ìš© ì œê±°
âœ… IAP êµ¬ë… ì‹œìŠ¤í…œ ì•ˆì •í™”
âœ… ë””ë°”ì´ìŠ¤ ID ê¸°ë°˜ ì¤‘ë³µ ë°©ì§€
```

#### **í™˜ê²½ ë³€ìˆ˜ (í”„ë¡œë•ì…˜)**
```bash
NODE_ENV=production
EXPO_PUBLIC_APP_ENV=production
EXPO_PUBLIC_SUPABASE_URL=https://syzefbnrnnjkdnoqbwsk.supabase.co
HERMESC_FLAGS=-O -output-source-map
```

---

## ğŸ“Š **ì™„ì„±ë„ í˜„í™© (2025-12-16 ê¸°ì¤€)**

### **ì „ì²´ ì™„ì„±ë„: 99%** â¬†ï¸ (+1%)

### **ì„¸ë¶€ ì˜ì—­ë³„ ì™„ì„±ë„**

| ì˜ì—­ | ì™„ì„±ë„ | ë³€ê²½ | ìƒíƒœ |
|------|--------|------|------|
| ğŸ¨ **í”„ë¡ íŠ¸ì—”ë“œ** | 95% | - | âœ… ì•ˆì • |
| âš™ï¸ **ë°±ì—”ë“œ** | 95% | â¬†ï¸ +20% | âœ… Supabase í”„ë¡œëª¨ì…˜ ì‹œìŠ¤í…œ |
| ğŸ’³ **ê²°ì œ ì‹œìŠ¤í…œ** | 95% | â¬†ï¸ +10% | âœ… í”„ë¡œëª¨ì…˜ ì—°ë™ ì™„ë£Œ |
| ğŸ” **ë³´ì•ˆ** | 90% | â¬†ï¸ +5% | âœ… RLS ì •ì±…, ë””ë°”ì´ìŠ¤ ID |
| âš¡ **ì„±ëŠ¥** | 95% | â¬†ï¸ +5% | âœ… ì•ˆë“œë¡œì´ë“œ ìµœì í™” |
| ğŸ“± **í¬ë¡œìŠ¤ í”Œë«í¼** | 100% | - | âœ… ì™„ë£Œ |
| ğŸ§ª **í…ŒìŠ¤íŠ¸** | 85% | - | ğŸ”„ ì§„í–‰ì¤‘ |
| ğŸ“š **ë¬¸ì„œí™”** | 90% | â¬†ï¸ +10% | âœ… í”„ë¡œëª¨ì…˜ ê°€ì´ë“œ |

---

### 1. **ë‹¤ì´ì–´ë¦¬ ìŠ¤í”„ë ˆë“œ ìˆ˜ì • ê¸°ëŠ¥ ì¶”ê°€** âœ… (Build 189 - ì´ì „ ì—…ë°ì´íŠ¸)

#### **êµ¬í˜„ ë‚´ìš©**
```
âœ… SpreadViewer ì»´í¬ë„ŒíŠ¸ í™•ì¥
   - ìˆ˜ì • ëª¨ë“œ í† ê¸€ ë²„íŠ¼ (âœï¸)
   - ì œëª© í¸ì§‘ ì¸ë¼ì¸ TextInput
   - ì¸ì‚¬ì´íŠ¸ í¸ì§‘ ë©€í‹°ë¼ì¸ TextInput
   - ì €ì¥/ì·¨ì†Œ ë²„íŠ¼ ê·¸ë£¹

âœ… ìƒíƒœ ê´€ë¦¬
   - isEditing: ìˆ˜ì • ëª¨ë“œ í”Œë˜ê·¸
   - editTitle: í¸ì§‘ ì¤‘ì¸ ì œëª©
   - editInsights: í¸ì§‘ ì¤‘ì¸ ì¸ì‚¬ì´íŠ¸
   - isSaving: ì €ì¥ ì¤‘ ë¡œë”© ìƒíƒœ

âœ… ì €ì¥ ë¡œì§
   - TarotUtils.updateSpread() í˜¸ì¶œ
   - updatedAt íƒ€ì„ìŠ¤íƒ¬í”„ ìë™ ìƒì„±
   - ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ ìƒíƒœ ë™ê¸°í™” (handleSpreadUpdated)
```

#### **ìˆ˜ì •ëœ íŒŒì¼**
```
components/TarotDaily.tsx
â”œâ”€â”€ SpreadViewerProps ì¸í„°í˜ì´ìŠ¤ í™•ì¥
â”œâ”€â”€ SpreadViewer ì»´í¬ë„ŒíŠ¸ (ì•½ 220ì¤„ ì¶”ê°€)
â”œâ”€â”€ handleSpreadUpdated í•¸ë“¤ëŸ¬
â””â”€â”€ ìƒˆë¡œìš´ ìŠ¤íƒ€ì¼ ì •ì˜ (12ê°œ)
```

### 2. **ê¸°ë¡ ì¹´ìš´íŠ¸ í‘œì‹œ ë²„ê·¸ ìˆ˜ì •** âœ…

#### **ë¬¸ì œì **
```typescript
// âŒ ê¸°ì¡´ ì½”ë“œ - TarotSession ê¸°ë°˜ (ë¶€ì •í™•)
// spread_savesì™€ TarotSessionì´ ë³„ë„ë¡œ ê´€ë¦¬ë˜ì–´ ì¹´ìš´íŠ¸ ë¶ˆì¼ì¹˜

checkUsageLimit('spread') â†’ limits.current_spread_sessions
// ì‹¤ì œ ì €ì¥ëœ ìŠ¤í”„ë ˆë“œì™€ ë‹¤ë¥¸ ê°’ ë°˜í™˜
```

#### **í•´ê²°ì±…**
```typescript
// âœ… ìˆ˜ì •ëœ ì½”ë“œ - spread_saves ì§ì ‘ ì¡°íšŒ (ì •í™•)
const spreadSavesData = await AsyncStorage.getItem('spread_saves');
if (spreadSavesData) {
  const spreads = JSON.parse(spreadSavesData);
  actualSpreadCount = Array.isArray(spreads) ? spreads.length : 0;
}
```

#### **ìˆ˜ì •ëœ íŒŒì¼**
```
utils/localStorage.ts
â””â”€â”€ checkUsageLimit() í•¨ìˆ˜ (type === 'spread' ë¶„ê¸°)
```

### 3. **ë²ˆì—­ í‚¤ ì¶”ê°€** âœ…

#### **ì¶”ê°€ëœ ë²ˆì—­**
| í‚¤ | í•œêµ­ì–´ | ì˜ì–´ | ì¼ë³¸ì–´ |
|----|--------|------|--------|
| journal.updatedDate | ìˆ˜ì • ë‚ ì§œ | Updated Date | æ›´æ–°æ—¥ |
| journal.noInsights | ê¸°ë¡ëœ ì¸ì‚¬ì´íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤ | No insights recorded | è¨˜éŒ²ã•ã‚ŒãŸã‚¤ãƒ³ã‚µã‚¤ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“ |

#### **ìˆ˜ì •ëœ íŒŒì¼**
```
i18n/locales/ko.json
i18n/locales/en.json
i18n/locales/ja.json
```

---

## ğŸ“¦ **Build 189 ë³€ê²½ ë‚´ì—­**

### ë³€ê²½ëœ íŒŒì¼ ëª©ë¡
| íŒŒì¼ | ë³€ê²½ ë‚´ìš© |
|------|----------|
| app.json | buildNumber: 188 â†’ 189 |
| components/TarotDaily.tsx | SpreadViewer ìˆ˜ì • ê¸°ëŠ¥ ì¶”ê°€ |
| utils/localStorage.ts | spread ì¹´ìš´íŠ¸ ë¡œì§ ìˆ˜ì • |
| i18n/locales/ko.json | updatedDate, noInsights ì¶”ê°€ |
| i18n/locales/en.json | updatedDate, noInsights ì¶”ê°€ |
| i18n/locales/ja.json | updatedDate, noInsights ì¶”ê°€ |

### ì»¤ë°‹ íˆìŠ¤í† ë¦¬
```
15d178d fix: Add spread edit functionality in diary and fix record count display (Build 189)
1592c2d feat: Add spread edit functionality and code optimization (Build 188)
266e69c fix: Improve subscription state stability with LocalStorage-first policy (Build 187)
```

---

## ğŸ¯ **ì´ì „ ì—…ë°ì´íŠ¸ ìš”ì•½**

### Build 187-188 (2025-12-09~10)
- êµ¬ë… ìƒíƒœ ì•ˆì •ì„± ê°œì„  (LocalStorage-first ì •ì±…)
- original_purchase_date_ms ì‚¬ìš©ìœ¼ë¡œ êµ¬ë…ì¼ ì¼ê´€ì„± í™•ë³´
- Apple ì„œë²„ purchase_date ì‚¬ìš©
- ìŠ¤í”„ë ˆë“œ íƒ­ì—ì„œ ìˆ˜ì • ê¸°ëŠ¥ êµ¬í˜„ (TarotSpread.tsx)

### Build 174 (2025-11-25)
- Android ë¡œì»¬ ë¹Œë“œ ì‹œìŠ¤í…œ êµ¬ì¶•
- gradlew.bat bundleRelease ëª…ë ¹ìœ¼ë¡œ AAB ìƒì„±
- Google Play ë°°í¬ ì¤€ë¹„ ì™„ë£Œ

### Build 150 (2025-11-21)
- Supabase ì„œë²„ë¦¬ìŠ¤ ë°±ì—”ë“œ êµ¬ì¶•
- Edge Function ì˜ìˆ˜ì¦ ê²€ì¦ ì‹œìŠ¤í…œ
- user_subscriptions, subscription_history í…Œì´ë¸”

---

## ğŸ“Š **ê¸°ëŠ¥ë³„ ì™„ì„±ë„**

| ê¸°ëŠ¥ | ì™„ì„±ë„ | ìµœê·¼ ì—…ë°ì´íŠ¸ |
|------|--------|---------------|
| íƒ€ì´ë¨¸ íƒ­ | 100% | - |
| ìŠ¤í”„ë ˆë“œ íƒ­ | 98% | Build 188 ìˆ˜ì • ê¸°ëŠ¥ |
| ë‹¤ì´ì–´ë¦¬ íƒ­ | 95% | Build 189 ìˆ˜ì • ê¸°ëŠ¥ |
| ì„¤ì • íƒ­ | 95% | - |
| IAP ê²°ì œ | 98% | Build 187 ì•ˆì •ì„± |
| Supabase ì—°ë™ | 95% | Build 187 |
| ë‹¤êµ­ì–´ ì§€ì› | 95% | Build 189 |

---

## ğŸ”œ **ë‹¤ìŒ ì‘ì—…**

1. iOS Build 189 Archive ë° TestFlight ì œì¶œ
2. ì‹¤ê¸°ê¸° í…ŒìŠ¤íŠ¸ (ë‹¤ì´ì–´ë¦¬ ìŠ¤í”„ë ˆë“œ ìˆ˜ì • ê¸°ëŠ¥)
3. Apple ì‹¬ì‚¬ ì œì¶œ

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025-12-10 22:15 KST
