# 버전 관리 정책 (Version Management Policy)

## 📌 핵심 룰

### ⚠️ MANDATORY: 빌드 전 버전 업그레이드 확인

**모든 빌드 실행 전에 반드시 사용자에게 물어볼 것:**

```
❓ 버전을 업그레이드 하시겠습니까?

현재 버전: [app.json에서 확인한 버전]

선택 가능한 옵션:
1. Patch (1.0.4 → 1.0.5): 버그 수정, 작은 변경
2. Minor (1.0.4 → 1.1.0): 새로운 기능 추가
3. Major (1.0.4 → 2.0.0): 대규모 변경, 호환성 변경
4. 현재 버전 유지 (1.0.4)

선택해주세요: [1/2/3/4]
```

---

## 📊 시맨틱 버저닝 (Semantic Versioning)

### 버전 형식: `MAJOR.MINOR.PATCH`

#### 1. **PATCH 버전** (1.0.4 → 1.0.5)
**사용 시기**:
- 버그 수정
- 작은 UI 조정
- 텍스트 수정
- 성능 최적화 (사용자에게 비가시적)
- 광고 설정 변경 (쿨다운 시간 등)

**예시**:
- 전면광고 쿨다운 3분 → 10분
- 오타 수정
- 크래시 버그 수정
- 로딩 속도 개선

---

#### 2. **MINOR 버전** (1.0.4 → 1.1.0)
**사용 시기**:
- 새로운 기능 추가 (하위 호환성 유지)
- 새로운 UI 컴포넌트 추가
- API 엔드포인트 추가
- 언어 추가 (예: 스페인어 지원)
- 새로운 타로 스프레드 추가

**예시**:
- 저널 검색 기능 추가
- 프리미엄 통계 화면 추가
- 푸시 알림 기능 추가
- 소셜 공유 기능 추가

---

#### 3. **MAJOR 버전** (1.0.4 → 2.0.0)
**사용 시기**:
- 대규모 아키텍처 변경
- 하위 호환성 깨지는 변경
- 전체 UI/UX 리디자인
- 백엔드 시스템 교체
- 주요 API 변경

**예시**:
- Supabase → Firebase 전환
- 완전히 새로운 디자인 시스템
- 메이저 리브랜딩
- 앱 구조 대규모 변경

---

## 🔢 BuildNumber 관리

### 자동 관리 (EAS Build)
- EAS Build는 **buildNumber를 자동으로 증가**시킴
- iOS: `expo.ios.buildNumber` (예: 36 → 37)
- Android: `expo.android.versionCode` (예: 39 → 40)

### 수동 관리가 필요한 경우
- **version** (app.json의 `expo.version`)만 수동으로 변경
- buildNumber는 EAS가 자동 처리

**예시**:
```json
{
  "expo": {
    "version": "1.0.5",  // 👈 이것만 수동으로 변경
    "ios": {
      "buildNumber": "37"  // 👈 EAS가 자동 증가 (37 → 38)
    }
  }
}
```

---

## 📝 버전 변경 워크플로우

### 빌드 요청 시 체크리스트

1. **현재 버전 확인**
   ```bash
   cat app.json | grep "version"
   ```
   출력 예시: `"version": "1.0.4"`

2. **사용자에게 버전 업그레이드 확인**
   - 항상 먼저 물어볼 것
   - 변경 내용 기반으로 옵션 제안

3. **사용자 선택에 따라 처리**
   - **Patch 선택**: 1.0.4 → 1.0.5
   - **Minor 선택**: 1.0.4 → 1.1.0
   - **Major 선택**: 1.0.4 → 2.0.0
   - **유지 선택**: 1.0.4 그대로

4. **app.json 버전 수정** (필요 시)
   ```bash
   # Edit 도구로 버전 변경
   ```

5. **빌드 실행**
   ```bash
   eas build --platform [ios/android] --profile [production/preview] --non-interactive
   ```

6. **빌드 완료 후 확인**
   - version: 사용자가 선택한 버전
   - buildNumber: EAS가 자동 증가한 번호

---

## 🚫 금지 사항

### ❌ 절대 하지 말 것
1. **사용자에게 묻지 않고 버전 자동 변경**
2. **buildNumber 수동 변경** (EAS에 맡길 것)
3. **버전 다운그레이드** (1.0.5 → 1.0.4)
4. **잘못된 시맨틱 버저닝**
   - 예: 새 기능 추가인데 Patch 버전 증가
   - 예: 버그 수정인데 Major 버전 증가

---

## 📋 버전 변경 가이드라인

### 변경 내용별 추천 버전

| 변경 내용 | 추천 버전 | 예시 |
|----------|----------|------|
| 광고 설정 변경 | Patch | 1.0.4 → 1.0.5 |
| 텍스트/번역 수정 | Patch | 1.0.4 → 1.0.5 |
| 크래시 버그 수정 | Patch | 1.0.4 → 1.0.5 |
| 작은 UI 수정 | Patch | 1.0.4 → 1.0.5 |
| 새로운 화면 추가 | Minor | 1.0.4 → 1.1.0 |
| 새로운 기능 추가 | Minor | 1.0.4 → 1.1.0 |
| 언어 추가 | Minor | 1.0.4 → 1.1.0 |
| 전체 디자인 변경 | Major | 1.0.4 → 2.0.0 |
| 백엔드 전환 | Major | 1.0.4 → 2.0.0 |
| API 호환성 변경 | Major | 1.0.4 → 2.0.0 |

---

## 🎯 실제 적용 예시

### 예시 1: iOS Build 35 (실제 케이스)
**변경 내용**:
- 전면광고 쿨다운 3분 → 10분
- 7일 무료체험 구독 타입 표시 수정
- 카드 다시뽑기 팝업 다국어화

**올바른 절차**:
1. 사용자에게 버전 업그레이드 확인 → **누락됨** ❌
2. 사용자가 빌드 요청 시 자동으로 1.0.3 → 1.0.4 증가 → **자동 처리됨** ⚠️
3. EAS Build가 buildNumber 36 → 37 자동 증가 ✅

**개선 방안**:
- 빌드 전에 "버전 업그레이드 하시겠습니까?" 물어봤어야 함
- Patch 변경이므로 1.0.3 → 1.0.4가 적절함

---

### 예시 2: 새로운 저널 검색 기능 추가 (가상)
**변경 내용**:
- 저널 탭에 검색 기능 추가
- 키워드로 과거 저널 검색
- 날짜 필터링 기능

**올바른 절차**:
1. 사용자: "저널 검색 기능 추가해줘"
2. Claude: "기능 추가 완료했습니다. 빌드하시겠습니까?"
3. 사용자: "빌드해줘"
4. Claude:
   ```
   ❓ 버전을 업그레이드 하시겠습니까?

   현재 버전: 1.0.4

   추천: Minor (1.0.4 → 1.1.0)
   이유: 새로운 기능 추가 (저널 검색)

   선택 가능한 옵션:
   1. Minor (1.0.4 → 1.1.0) 👈 추천
   2. Patch (1.0.4 → 1.0.5)
   3. 현재 버전 유지 (1.0.4)

   선택해주세요: [1/2/3]
   ```
5. 사용자: "1"
6. Claude: app.json 버전을 1.1.0으로 변경 후 빌드 실행

---

## 📝 체크리스트

### 빌드 요청 시 필수 확인
- [ ] 사용자에게 버전 업그레이드 확인 질문
- [ ] 변경 내용 기반 추천 옵션 제시
- [ ] 사용자 선택 대기
- [ ] 선택에 따라 app.json 버전 수정
- [ ] 빌드 실행
- [ ] 빌드 완료 후 버전 정보 확인 및 보고

---

**작성일**: 2025-10-20
**적용 시작**: 즉시
**우선순위**: 🔴 CRITICAL (모든 빌드에 적용)
