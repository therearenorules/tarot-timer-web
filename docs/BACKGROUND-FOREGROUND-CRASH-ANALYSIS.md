# 백그라운드/포그라운드 전환 크래시 분석

## 🔍 문제 상황
**증상**: TestFlight에서 앱을 나갔다가 다시 들어오면 오류 화면이 계속 나타남

## ❓ 필요한 정보

TestFlight에서 크래시 로그를 확인하는 방법:

### 방법 1: App Store Connect에서 확인
1. App Store Connect 로그인
2. "My Apps" → "Tarot Timer" 선택
3. "TestFlight" 탭 → "Builds" 선택
4. Build 81 또는 82 클릭
5. "Crashes" 탭에서 크래시 로그 확인

### 방법 2: TestFlight 앱에서 직접 전송
1. TestFlight 앱 열기
2. Tarot Timer 선택
3. "Send Beta Feedback" 버튼
4. 크래시 발생 시점 설명 + 스크린샷 첨부

### 방법 3: Xcode Organizer에서 확인
1. Xcode 열기
2. Window → Organizer
3. "Crashes" 탭
4. Tarot Timer 앱 선택
5. 최근 크래시 로그 확인

## 🎯 확인해야 할 정보

다음 정보를 확인해주세요:

1. **오류 메시지**: 오류 화면에 표시되는 텍스트
2. **발생 시점**: 백그라운드 → 포그라운드 전환 직후인지, 몇 초 후인지
3. **발생 빈도**: 매번 발생하는지, 가끔 발생하는지
4. **앱 상태**: 특정 탭에서만 발생하는지, 모든 탭에서 발생하는지

## 🧪 임시 디버깅 방법

TestFlight 빌드에서 크래시 로그를 확인할 수 없다면, 다음 방법을 시도:

### A. 콘솔 앱 사용 (Mac 필요)
1. iPhone을 Mac에 연결
2. Mac에서 "콘솔" 앱 실행
3. 왼쪽 사이드바에서 iPhone 선택
4. 검색창에 "Tarot Timer" 입력
5. 앱을 백그라운드 → 포그라운드 전환
6. 콘솔에 출력되는 모든 로그 복사

### B. 개발자 빌드로 테스트
1. Expo Go가 아닌 **Development Build** 생성
2. iPhone에 직접 설치
3. 크래시 발생 시 Metro 콘솔에 로그 출력

## 🛠️ 예상 원인 및 해결 방안

### 원인 1: AppState 리스너 과부하
**증상**: 포그라운드 복귀 시 여러 Context가 동시에 작업 실행
**해결**: 디바운스 및 우선순위 큐 구현

### 원인 2: Native 모듈 초기화 실패
**증상**: IAP, 광고, 알림 시스템 중 하나가 실패
**해결**: 각 모듈을 완전히 독립적으로 초기화

### 원인 3: 메모리 부족
**증상**: 백그라운드에서 메모리 정리 후 포그라운드 복귀 시 state 손실
**해결**: AsyncStorage로 중요 상태 지속

### 원인 4: Hermes 엔진 최적화 문제
**증상**: Production 빌드에서만 발생
**해결**: 함수 참조 안정화 (이미 적용됨)

## 📝 다음 단계

**Option 1**: 크래시 로그 제공 → 정확한 수정
**Option 2**: 임시 방어 코드 강화 → 추측 기반 수정 (현재 진행 중)
**Option 3**: Development Build 생성 → 실시간 디버깅

어떤 방법을 선호하시나요?
